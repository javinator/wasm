 <!DOCTYPE html>
<html>
<head>
<style>
body {bgcolor: #ddd; font-family: Arial;}
</style>
</head>
<body>

<h1>My First Web Page</h1>
<p>My First Paragraph</p>

<script>
class Visitor {

visitModule(node) {
	var out = "";
  var i;
  for (i = 0; i < node.children.length; i++) {
  	out = out.concat(node.children[i].visit());
  }
  
	return "(module\n".concat(out,"(export \"main\" (func $main))\n)");
}

visitDefineMain(node) {
	return "(func $main (result f64)\n".concat(node.children[0].visit(),"\n)\n");
}

visitDefineFunction(node) {
	var out = "";
  var i;
  for (i = 0; i < node.children[0].length; i++) {
  	out = out.concat(node.children[0][i].visit());
  }
	return "(func $".concat(node.data[0],out," (result f64)\n",node.children[1].visit(),"\n)\n");
}

visitExpression(node) {
	return node.children[0].visit();
}

visitIf(node) {
	return "(if ".concat(node.children[0].visit(),"\n(then ",node.children[1].visit(),")\n").concat("(else ",node.children[2].visit(),"))");
}

visitWhile(node) {
	return "(loop\n".concat(node.children[1].visit(),"\n(br_if 0 ",node.children[0].visit(),"))");
}

visitBool(node) {
	if (node.data[0] === "==") { return "(f64.eq ".concat(node.children[0].visit(),node.children[1].visit(),")");}
    	if (node.data[0] === "!=") { return "(f64.ne ".concat(node.children[0].visit(),node.children[1].visit(),")");}
    	if (node.data[0] === "<") { return "(f64.lt ".concat(node.children[0].visit(),node.children[1].visit(),")");}
    	if (node.data[0] === "<=") { return "(f64.le ".concat(node.children[0].visit(),node.children[1].visit(),")");}
    	if (node.data[0] === ">") { return "(f64.gt ".concat(node.children[0].visit(),node.children[1].visit(),")");}
    	if (node.data[0] === ">=") { return "(f64.ge ".concat(node.children[0].visit(),node.children[1].visit(),")");}
}

visitCallFunction(node) {
	return "(call $".concat(node.data[0],node.data[1],")");
}

visitCallParameter(node) {
	return node.children[0].visit();
}

visitDefine(node) {
	return "(local $".concat(node.data[0]).concat(" f64)");
}

visitAssign(node) {
	return "(set_local $".concat(node.data[0],node.children[0].visit(),")");
}

visitMath(node) {
	if (node.data[0] === "+") {return "(f64.add ".concat(node.children[0].visit(),node.children[1].visit(),")");}
        if (node.data[0] === "-") {return "(f64.sub ".concat(node.children[0].visit(),node.children[1].visit(),")");}
}

visitTerm(node) {
	if (node.data[0] === "*") {return "(f64.mul ".concat(node.children[0].visit(),node.children[1].visit(),")");}
        if (node.data[0] === "/") {return "(f64.div ".concat(node.children[0].visit(),node.children[1].visit(),")");}
}

visitParameter(node) {
	return "(param $".concat(node.data[0], " f64)");
}

visitFactor(node) {
	return node.children[0].visit();
}

visitInteger(node) {
	return "(f64.const ".concat(node.data[0],")");
}

visitGetVariable(node) {
	return "(get_local $".concat(node.data[0],")");
}
}

const visit = new Visitor();
class Node {
		constructor() {
        	this.name = "Abstract Node";
            this.data = [];
			this.children = [];
		}
	}
    
class Module extends Node {
    	constructor(main,func) {
        	super();
            this.name = "Module";
            this.children = [main,func];
		}
    visit() {
    	return visit.visitModule(this);
    }
    }

class DefineMain extends Node {
    	constructor(exp) {
        	super();
            this.name = "Define Main";
            this.children = [exp];
		}
    visit() {
    	return visit.visitDefineMain(this);
    }
	}

class DefineFunction extends Node {
    	constructor(name,para,exp) {
        	super();
            this.name = "Define Function";
            this.children = [para,exp];
            this.data = [name];
		}
    visit() {
    	return visit.visitDefineFunction(this);
    }
	}
    
class Expression extends Node {
    	constructor(exp) {
        	super();
            this.name = "Expression";
            this.children = [exp];
        }
       visit() {
    	return visit.visitExpression(this);
    }
	}
    
class If extends Node {
    	constructor(bool,exp,elseexp) {
        	super();
            this.name = "If";
            this.children = [bool,exp,elseexp];
        }
        visit() {
    	return visit.visitIf(this);
    }
	}
    
    	class While extends Node {
    		constructor(bool,exp) {
        		super();
            		this.name = "While";
            		this.children = [bool,exp];
        	}
          visit() {
    	return visit.visitWhile(this);
    }
	}
    
    	class Bool extends Node {
    		constructor(head,op,tail) {
        		super();
           		this.name = "Bool";
            		this.children = [head,tail];
            		this.data = [op];
        	}
          visit() {
    	return visit.visitBool(this);
    }
	}


	class CallFunction extends Node {
    		constructor(name,para) {
        		super();
            		this.name = "Call Function";
            		this.data = [name,para];
        	}
          visit() {
    	return visit.visitCallFunction(this);
    }
	}

    	class CallParameter extends Node {
    		constructor(para) {
        		super();
            		this.name = "Call Parameter";
            		this.children = [para];
        	}
          visit() {
    	return visit.visitCallParameter(this);
    }
	}

	class Define extends Node {
    		constructor(char) {
        		super();
            		this.name = "Define";
            		this.data = [char];
        	}
          visit() {
    	return visit.visitDefine(this);
    }
	}

	class Assign extends Node {
    		constructor(char, exp) {
        		super();
            		this.name = "Assign";
            		this.children = [exp];
            		this.data = [char];
        	}
          visit() {
    	return visit.visitAssign(this);
    }
	}

	class Math extends Node {
    		constructor(head,op,tail) {
        		super();
            		this.name = "Math";
            		this.children = [head,tail];
            		this.data = [op];
        	}
          visit() {
    	return visit.visitMath(this);
    }
	}

	class Term extends Node {
    		constructor(head,op,tail) {
        		super();
            		this.name = "Term";
            		this.children = [head,tail];
            		this.data = [op];
        	}
          visit() {
    	return visit.visitTerm(this);
    }
	}

	class Parameter extends Node {
    		constructor(char) {
        		super();
            		this.name = "Parameter";
            		this.data = [char];
        	}
          visit() {
    	return visit.visitParameter(this);
    }
	}

	class Factor extends Node {
    		constructor(exp) {
        		super();
            		this.name = "Factor";
            		this.children = [exp];
        	}
          visit() {
    	return visit.visitFactor(this);
    }
	}

    	class Integer extends Node {
    		constructor(int) {
        		super();
            		this.name = "Integer";
            		this.data = [int];
        	}
          visit() {
    	return visit.visitInteger(this);
    }
	}
    
    	class GetVariable extends Node {
    		constructor(char) {
        		super();
            		this.name = "Get Variable";
            		this.data = [char];
        	}
          visit() {
    	return visit.visitGetVariable(this);
    }
	}

	class Character extends Node {
    		constructor(char) {
        		super();
            		this.name = "Character";
            		this.data = [char];
        	}
          visit() {
    	return visit.visitCharacter(this);
    }
	}

var in1 = new Integer(1);
var in2 = new Integer(2);
var math = new Math(in1,"+",in2);
var exp = new Expression(math);
var main = new DefineMain(exp);
var vara = new GetVariable("a");
var varb = new GetVariable("b");
var math2 = new Math(vara,"-",varb);
var pa = new Parameter("a");
var pb = new Parameter("b");
var pc = new Parameter("c");
var foo = new DefineFunction("foo",[pa,pb,pc],math2);
var mod = new Module(main,foo);
document.write(visit.visitModule(mod));
</script>

</body>
</html> 